<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spieler der Woche</title>
<style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
    body { background:#f5f5f5; color:#111; overflow-x:hidden; }
    header { text-align:center; padding:30px; background:#1db954; color:white; box-shadow: 0 4px 10px rgba(29,185,84,0.3); border-bottom: 3px solid #17a44b; }
    header h1 { font-size:2.5rem; letter-spacing:2px; }
    header p { margin-top:5px; color:#e0ffe0; }

    .container { display:flex; justify-content:center; flex-wrap:wrap; gap:25px; padding:50px 10%; }
    .player-card { background: rgba(29,185,84,0.1); border-radius: 20px; width: 280px; text-align: center; padding: 25px; box-shadow: 0 0 15px rgba(29,185,84,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease; position: relative; }
    .player-card:hover { transform: translateY(-8px); box-shadow: 0 0 25px rgba(29,185,84,0.4); }
    .player-img { width:120px; height:120px; border-radius:50%; border:4px solid #1db954; margin-bottom:15px; object-fit:cover; }
    .rank { position:absolute; top:10px; left:10px; background:#1db954; color:white; padding:8px 14px; border-radius:12px; font-weight:bold; font-size:0.9rem; box-shadow:0 0 10px rgba(29,185,84,0.5); }
    .player-card h2 { margin-bottom:10px; }
    .stats { font-size:0.9rem; color:#333; margin-bottom:10px; }
    .score { background: linear-gradient(90deg, #1db954, #17a44b); color: #fff; border-radius:10px; padding:8px; display:inline-block; font-weight:bold; margin-top:10px; box-shadow:0 0 10px rgba(29,185,84,0.5); }
    .btn-vote { background:#1db954; color:white; border:none; padding:10px 15px; border-radius:12px; margin:5px; cursor:pointer; font-weight:bold; transition:0.3s; }
    .btn-vote:hover { background:#17a44b; transform:scale(1.05); }
    footer { text-align:center; color:#555; font-size:0.9rem; margin:30px 0; }
    footer a { color:#1db954; text-decoration:none; }
    footer a:hover { text-decoration:underline; }
    .admin-panel { margin:30px auto; background: rgba(29,185,84,0.1); padding:20px; border-radius:15px; text-align:center; width:90%; max-width:500px; }
    .admin-panel input { padding:8px 12px; border-radius:8px; border:1px solid #1db954; margin:5px; width:150px; }
    .admin-panel button { padding:8px 15px; border-radius:10px; border:none; cursor:pointer; background:#1db954; color:white; margin:5px; font-weight:bold; }
    .admin-panel button:hover { background:#17a44b; }
</style>
</head>
<body>

<header>
    <h1>Spieler der Woche</h1>
    <p>powered by GoalNews</p>
</header>

<div class="container" id="playerContainer"></div>

<div style="text-align:center;">
    <h3>WÃ¤hle deinen Spieler:</h3>
    <div id="voteButtons"></div>
</div>

<div id="adminPanel" class="admin-panel" style="display:none;">
    <h3>Admin Panel</h3>
    <input type="text" id="newPlayerName" placeholder="Spielername">
    <input type="text" id="newPlayerImg" placeholder="Bild-URL">
    <input type="text" id="newPlayerStats" placeholder="Stats z.B. 2 Tore">
    <button id="addPlayerBtn">Spieler hinzufÃ¼gen</button>
</div>

<footer>
    <p>Â© 2025 GoalNews â€¢ <a href="index.html">ZurÃ¼ck zur Startseite</a></p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
import { getFirestore, doc, setDoc, updateDoc, increment, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

// ðŸ”¹ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBmIcdFtxv4jBJKdiAkEiwnkQ8yRwiG_0w",
  authDomain: "goalnewsde-community.firebaseapp.com",
  projectId: "goalnewsde-community",
  storageBucket: "goalnewsde-community.firebasestorage.app",
  messagingSenderId: "134523022055",
  appId: "1:134523022055:web:4f35ed7812d06e4fb55042"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ðŸ”¹ Admin UIDs
const adminUIDs = ["g7Lsh9MshAOkwbyHcO3NFsnUpZl1","lwRnonWRhMOeYedZLAldySkEKso2"];

// ðŸ”¹ Spieler Liste
let players = [
    { name: "Jamal Musiala", img: "ChatGPT Image 5. Nov. 2025, 20_45_50.png", stats: "", score: 0 },
    { name: "Harry Kane", img: "ChatGPT Image 5. Nov. 2025, 20_45_50.png", stats: "", score: 0 },
    { name: "Joshua Kimmich", img: "ChatGPT Image 5. Nov. 2025, 20_45_50.png", stats: "", score: 0 }
];

// ðŸ”¹ Firestore Dokument
const pollDocRef = doc(db, "polls", "player_of_the_week");

// ðŸ”¹ Auth anonym & Admin Check
signInAnonymously(auth).catch(console.error);
onAuthStateChanged(auth, user => {
    if(user && adminUIDs.includes(user.uid)){
        document.getElementById("adminPanel").style.display = "block";
    }
});

// ðŸ”¹ Init Firestore
(async () => {
    const docSnap = await getDoc(pollDocRef);
    if(!docSnap.exists()){
        const optionsObj = {};
        players.forEach(p => optionsObj[p.name] = 0);
        await setDoc(pollDocRef, { options: optionsObj, scores: {} });
    }
})();

// ðŸ”¹ Admin: Spieler hinzufÃ¼gen
document.getElementById("addPlayerBtn").onclick = async () => {
    const name = document.getElementById("newPlayerName").value.trim();
    const img = document.getElementById("newPlayerImg").value.trim();
    const stats = document.getElementById("newPlayerStats").value.trim();
    if(!name) return alert("Name eingeben!");
    players.push({ name, img, stats, score: 80 });
    await updateDoc(pollDocRef, { [`options.${name}`]: 0 });
    document.getElementById("newPlayerName").value = "";
    document.getElementById("newPlayerImg").value = "";
    document.getElementById("newPlayerStats").value = "";
};

// ðŸ”¹ Vote Buttons
const voteButtonsDiv = document.getElementById("voteButtons");
function renderVoteButtons(){
    voteButtonsDiv.innerHTML = "";
    players.forEach(player => {
        const btn = document.createElement("button");
        btn.className = "btn-vote";
        btn.textContent = player.name;
        btn.onclick = async () => {
            const votedKey = "voted_player";
            const prevVote = localStorage.getItem(votedKey);

            if(prevVote && prevVote !== player.name){
                await updateDoc(pollDocRef, { [`options.${prevVote}`]: increment(-1) });
            }

            if(prevVote !== player.name){
                await updateDoc(pollDocRef, { [`options.${player.name}`]: increment(1), [`scores.${player.name}`]: increment(1) });
                localStorage.setItem(votedKey, player.name);
            }
        };
        voteButtonsDiv.appendChild(btn);
    });
}
renderVoteButtons();

// ðŸ”¹ Spieler anzeigen & live update
const container = document.getElementById("playerContainer");
onSnapshot(pollDocRef, docSnap => {
    const data = docSnap.data();
    if(!data.scores) data.scores = {};
    let maxVotes = -1, topPlayerName = "";
    for(const [name,votes] of Object.entries(data.options)){
        if(votes > maxVotes){ maxVotes = votes; topPlayerName = name; }
    }
    container.innerHTML = "";
    players.forEach(player => {
        const votes = data.options[player.name] || 0;
        const score = (data.scores[player.name] || player.score) + votes;
        const card = document.createElement("div");
        card.className = "player-card";
        const rankDiv = document.createElement("div");
        rankDiv.className = "rank";
        rankDiv.textContent = player.name === topPlayerName ? "#1" : "";
        card.appendChild(rankDiv);
        const img = document.createElement("img"); img.src = player.img; img.className = "player-img"; card.appendChild(img);
        const nameH2 = document.createElement("h2"); nameH2.textContent = player.name; card.appendChild(nameH2);
        const statsDiv = document.createElement("div"); statsDiv.className="stats"; statsDiv.textContent = player.stats; card.appendChild(statsDiv);
        const scoreDiv = document.createElement("div"); scoreDiv.className="score"; scoreDiv.textContent = `Score: ${score} Punkte | Votes: ${votes}`; card.appendChild(scoreDiv);
        container.appendChild(card);
    });
});
</script>

</body>
</html>