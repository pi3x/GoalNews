<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>GoalNews â€“ Adventskalender</title>
<style>
body {
    font-family: "Poppins", sans-serif;
    background: linear-gradient(to bottom, #001 0%, #111 100%);
    margin:0; padding:0; text-align:center; color:white; overflow-x:hidden;
}
.container {
    max-width: 800px;
    background: rgba(0,0,0,0.6);
    margin: 40px auto;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.5);
}
h1 { color: #FFD700; font-size: 2.2em; text-shadow: 0 0 10px #fff; }
#coinDisplay { font-size: 1.5em; margin-bottom: 20px; color:#1db954; }
.calendar { display:flex; flex-wrap: wrap; justify-content:center; gap:15px; margin-top:20px; }
.day {
    width: 70px; height:70px; background: #8B0000; color: gold;
    display:flex; justify-content:center; align-items:center;
    font-weight:bold; border-radius:15px; cursor:pointer;
    position:relative; box-shadow: 0 0 10px #fff;
    transition: transform 0.3s, background 0.3s;
}
.day:hover { transform: scale(1.1); background: #B22222; }
.day.opened { background: green; color:white; cursor:default; box-shadow:0 0 20px #1db954; }
.tooltip { position:absolute; top:-40px; left:50%; transform:translateX(-50%);
    background:#333; padding:5px 10px; border-radius:5px; font-size:0.8em; display:none; }
.day.opened .tooltip { display:block; animation: pop 0.5s ease forwards; }
@keyframes pop { 0% {transform:scale(0.5);opacity:0;} 100%{transform:scale(1);opacity:1;} }
#result { margin-top:20px; font-size:1.2em; color:#FFD700; text-shadow:0 0 5px #fff; }
.lights { width:100%; display:flex; justify-content:space-around; margin-bottom:20px; }
.light { width:15px; height:15px; border-radius:50%; box-shadow:0 0 10px #fff; animation: blink 1.5s infinite alternate; }
.light.red { background:red; }
.light.yellow { background:yellow; }
.light.green { background:green; }
.light.blue { background:blue; }
@keyframes blink { 0% {opacity:0.3;} 50%{opacity:1;} 100%{opacity:0.3;} }
/* Schnee */
.snowflake {
    position: fixed; top:-10px; color:white; font-size:1em;
    animation-name: fall; animation-iteration-count: infinite;
    animation-timing-function: linear; z-index:9999;
}
@keyframes fall { 0% {transform:translateY(0) rotate(0deg);} 100% {transform:translateY(100vh) rotate(360deg);} }

.logo{
  width: 180px;                  /* GrÃ¶ÃŸe */
  border-radius: 20px;           /* Ecken abrunden */
  transition: 0.3s ease;         /* weiche Animation */
  object-fit: cover;             /* passt perfekt in den Rahmen */
  box-shadow: 0 8px 20px rgba(0,0,0,0.25); /* moderner Schatten */
}

/* Beim DrÃ¼berfahren */
.logo:hover {
  transform: scale(1.05);        /* leicht grÃ¶ÃŸer */
  box-shadow: 0 12px 28px rgba(0,0,0,0.35);
}

</style>
</head>
<body>
<div class="container">
<h1>ðŸŽ„GoalNews AdventskalenderðŸŽ„</h1>
<img src="GoalNews Weihnachts Logo.png" alt="logo" class="logo">
<div class="lights">
    <div class="light red"></div>
    <div class="light yellow"></div>
    <div class="light green"></div>
    <div class="light blue"></div>
    <div class="light red"></div>
</div>
<p id="coinDisplay">ðŸ’° Coins: 0</p>
<div class="calendar" id="calendar"></div>
<div id="result"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyBmIcdFtxv4jBJKdiAkEiwnkQ8yRwiG_0w",
    authDomain: "goalnewsde-community.firebaseapp.com",
    projectId: "goalnewsde-community",
    storageBucket: "goalnewsde-community.firebasestorage.app",
    messagingSenderId: "134523022055",
    appId: "1:134523022055:web:4f35ed7812d06e4fb55042"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const calendarEl = document.getElementById("calendar");
const coinDisplay = document.getElementById("coinDisplay");
const result = document.getElementById("result");

function createSnowflake() {
    const s = document.createElement("div");
    s.className="snowflake";
    s.textContent="â„";
    s.style.left=Math.random()*window.innerWidth+"px";
    s.style.fontSize=(12+Math.random()*24)+"px";
    s.style.animationDuration=(5+Math.random()*10)+"s";
    document.body.appendChild(s);
    setTimeout(()=>s.remove(),15000);
}
setInterval(createSnowflake,200);

onAuthStateChanged(auth, async user=>{
    if(!user){ 
        result.textContent="ðŸ”’ Du musst fÃ¼r diese Funktion angemeldet sein!";
        return;
    }

    const userRef = doc(db,"users",user.uid);
    let snap = await getDoc(userRef);
    let data = snap.data() || { coins:0, openedDays:{} };
    coinDisplay.textContent=`ðŸ’° Coins: ${data.coins}`;

    const todayDate = new Date();
    const month = todayDate.getMonth() + 1; // 1-12
    const dayOfMonth = todayDate.getDate();

    for(let i=1;i<=24;i++){
        const dayDiv=document.createElement("div");
        dayDiv.className="day";
        dayDiv.textContent=i;

        const tooltip = document.createElement("div");
        tooltip.className="tooltip";
        tooltip.textContent="ðŸŽ Ã–ffnen fÃ¼r Ãœberraschung!";
        dayDiv.appendChild(tooltip);
        calendarEl.appendChild(dayDiv);

        // Bereits geÃ¶ffnet?
        if(data.openedDays && data.openedDays[i]){
            dayDiv.classList.add("opened");
            tooltip.textContent="âœ… Schon geÃ¶ffnet";
        }

        dayDiv.onclick = async () => {
            const todayStr = todayDate.toISOString().split("T")[0];
            if(!data.openedDays) data.openedDays = {};

            // TÃ¼rchen noch nicht verfÃ¼gbar?
            if(month < 12 || (month === 12 && dayOfMonth < i)){
                result.textContent = `âŒ TÃ¼rchen ${i} ist noch nicht verfÃ¼gbar!`;
                return;
            }

            // TagesprÃ¼fung: TÃ¼rchen heute schon geÃ¶ffnet?
            if(data.openedDays[i] === todayStr){
                result.textContent = "âŒ Du hast dieses TÃ¼rchen heute schon geÃ¶ffnet!";
                return;
            }

            dayDiv.style.pointerEvents="none";
            dayDiv.classList.add("spin");

            setTimeout(async ()=>{
                let reward;
                if(i===24){
                    reward = "ðŸŽ… Breaking News Leiste Freigeschaltet! Merry Cristmas ðŸŽ…";
                    await setDoc(userRef, { breakingNews: true }, { merge: true });
                } else {
                    const surprises = [() => Math.floor(Math.random()*151)]; // Coins
                    const choice = surprises[Math.floor(Math.random()*surprises.length)];
                    reward = choice();
                }

                // Coins aktualisieren
                if(typeof reward === "number"){
                    data.coins = (data.coins || 0) + reward;
                    coinDisplay.textContent=`ðŸ’° Coins: ${data.coins}`;
                }

                data.openedDays[i] = todayStr;
                await setDoc(userRef, data, { merge: true });

                result.textContent = `ðŸŽ‰ COINS: ${reward}`;
                dayDiv.classList.remove("spin");
                dayDiv.classList.add("opened");
                tooltip.textContent="âœ… Schon geÃ¶ffnet";

            },1000);
        }
    }
});
</script>
</body>
</html>


