<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GoalNews - Foot- & Fu√üballnews</title>

    <!-- Google Analytics 4 -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-C1HQFFK8NB"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-C1HQFFK8NB", { anonymize_ip: true });
    </script>

    <!-- Favicon -->
    <link
      rel="icon"
      href="https://i.ibb.co/21R6p75W/Logo-1.jpg"
      type="image/jpeg"
    />
    <link rel="stylesheet" href="style.css" />

    <!-- PWA -->
    <meta name="theme-color" content="#1db954" />
    <link rel="apple-touch-icon" href="https://i.ibb.co/21R6p75W/Logo-1.jpg" />
    <link rel="manifest" href="manifest.json" />

    <style>
      /* ===== Super Bowl Countdown ===== */
      .sb-countdown {
        max-width: 900px;
        margin: 60px auto;
        padding: 30px 20px;
        background: linear-gradient(145deg, var(--bg-card), #0b0b0b);
        border-radius: var(--radius-lg);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
      }

      .sb-label {
        display: block;
        margin-bottom: 20px;
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--green-main);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .sb-timer {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
      }

      .sb-box {
        background: #0f0f0f;
        border-radius: var(--radius-md);
        padding: 18px 10px;
        box-shadow: inset 0 0 0 1px #1c1c1c;
      }

      .sb-box span {
        display: block;
        font-size: 2.4rem;
        font-weight: 800;
        color: #fff;
        font-variant-numeric: tabular-nums;
      }

      .sb-box small {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--green-soft);
      }

      /* Mobile */
      @media (max-width: 600px) {
        .sb-timer {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>

  <body>
    <!-- Header -->
    <header>
      <div class="logo">GoalNews</div>

      <!-- Hamburger -->
      <button id="burger" class="menu" aria-label="Men√º anzeigen">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Side Menu -->
      <nav id="sideMenu" class="side-menu">
        <ul>
          <li><a href="highlights.html">Bundesliga Highlights</a></li>
          <li><a href="ueber_uns.html">About Us</a></li>
          <li><a href="experten-tipp.html">Experten-Tipp</a></li>
          <li><a href="live-football.html">Football Liveticker</a></li>
          <li><a href="login.html">Login/Registrieren</a></li>
          <li><a href="bundesliga.html">Bundesliga</a></li>
          <li><a href="2liga.html">2. Bundesliga</a></li>
          <li><a href="comments.html">Kommentar Forum</a></li>
          <li><a href="feedback.html">Helfen Sie uns!</a></li>
          <li><a href="coins.html">Was sind COINS</a></li>
          <li><a href="download.html">Downloads/PDFs</a></li>
          <li>
            <a href="https://whatsapp.com/channel/0029Vb7PDwN8V0toB3ATWZ1Y"
              >WhatsApp</a
            >
          </li>
        </ul>
      </nav>
    </header>

    <!-- Breaking News -->
    <div id="breakingNews" class="locked">
      <div class="news-wrapper">
        <span class="news-item">
          Der Superbowl LX startet in wenigen Tagen - Seattle Seahawks @ New
          England Patriots - Wer holt sich die Krone?
        </span>
        <span class="news-item">
          Dortmund verk√ºrzt den abstand auf die Bayern! 2:1 Sieg gegen die
          W√∂lfe!
        </span>
        <span class="news-item">
          Dzeko macht den Doppelpack gegen Kaiserslautern und sichert ein 2:2
          unentschieden!
        </span>
        <span class="news-item">
          Bad Bunny √§ussert sich nicht gegen Trump!
        </span>
      </div>
    </div>

    <section class="sb-countdown">
      <span class="sb-label">üèà Super Bowl Countdown</span>

      <div class="sb-timer">
        <div class="sb-box">
          <span id="sb-days">0</span>
          <small>Tage</small>
        </div>
        <div class="sb-box">
          <span id="sb-hours">0</span>
          <small>Std</small>
        </div>
        <div class="sb-box">
          <span id="sb-minutes">0</span>
          <small>Min</small>
        </div>
        <div class="sb-box">
          <span id="sb-seconds">0</span>
          <small>Sek</small>
        </div>
      </div>
    </section>

    <!-- Countdown -->
    <h2>‚è±Ô∏è 21. Spieltag startet in:</h2>
    <div id="countdown">lade...</div>

    <!-- Bundesliga Spieltag -->
    <div class="matches" style="text-align: center; margin-top: 40px">
      <h2>üèÜ Bundesliga-Spieltag 21</h2>
      <h3>21. Spieltag (6.2.2026 - 8.2.2026)</h3>
      <div>
        <h4>Freitag, 6.2.2026:</h4>
        <p>Union Berlin 20:30 Eintracht Frankfurt</p>
        <h4>Samstag, 7.2.2026:</h4>
        <p>
          SC Freiburg 15:30 Werder Bremen<br />
          FSV Mainz 05 15:30 FC Augsburg<br />
          VfL Wolfsburg 15:30 Bor. Dortmund<br />
          FC St. Pauli 15:30 VfB Stuttgart<br />
          FC Heidenheim 15:30 Hamburger SV<br />
          <strong class="topspiel"
            >Topspiel: Bor. M'gladbach 18:30 Bayer Leverkusen</strong
          >
        </p>
        <h4>Sonntag, 8.2.2026:</h4>
        <p>
          1. FC K√∂ln 15:30 RB Leipzig<br />
          Bayern M√ºnchen 17:30 TSG Hoffenheim<br />
        </p>
      </div>
    </div>

    <!-- Live Spiele -->
    <section id="liveGamesSection">
      <h2>Live Spiele</h2>
      <p>Alle Spiele sind live und im Gange</p>
      <p>Durchgestrichene Spiele sind beendet</p>
      <p>
        Unser Experten Tipp Gibt es auf unserer
        <a href="experten-tipp.html">Experten Seite</a>
      </p>
      <table class="matches-table">
        <thead>
          <tr>
            <th>Heimteam</th>
            <th>Gastteam</th>
            <th>Ergebnis / Zeit</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td colspan="3">Lade Spiele...</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <span class="footer-copy"
        >¬© 2026 GoalNews | Built by piex_ and EliXTech</span
      >
      <nav class="footer-links">
        <a href="impressum.html">Impressum</a> | <a href="agb.html">AGB</a> |
        <a href="datenschutz.html">Datenschutz</a>
      </nav>
    </footer>

    <!-- Scripts -->

    <script>
      (function () {
        // Super Bowl 2026
        // Super Bowl LX ‚Äì 8. Februar 2026, 00:30 MEZ
        const superBowlDate = new Date("2026-02-09T00:30:00+01:00");

        const dEl = document.getElementById("sb-days");
        const hEl = document.getElementById("sb-hours");
        const mEl = document.getElementById("sb-minutes");
        const sEl = document.getElementById("sb-seconds");

        function updateSBCountdown() {
          const now = new Date();
          let diff = superBowlDate - now;

          if (diff <= 0) {
            dEl.textContent = "0";
            hEl.textContent = "0";
            mEl.textContent = "0";
            sEl.textContent = "0";
            return;
          }

          const days = Math.floor(diff / 86400000);
          diff %= 86400000;
          const hours = Math.floor(diff / 3600000);
          diff %= 3600000;
          const minutes = Math.floor(diff / 60000);
          const seconds = Math.floor((diff % 60000) / 1000);

          dEl.textContent = days;
          hEl.textContent = hours.toString().padStart(2, "0");
          mEl.textContent = minutes.toString().padStart(2, "0");
          sEl.textContent = seconds.toString().padStart(2, "0");
        }

        updateSBCountdown();
        setInterval(updateSBCountdown, 1000);
      })();
    </script>

    <script type="module">
      // ===== Firebase & Live Games Setup =====
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        doc,
        onSnapshot,
      } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
      import {
        getAuth,
        onAuthStateChanged,
        setPersistence,
        browserLocalPersistence,
      } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBmIcdFtxv4jBJKdiAkEiwnkQ8yRwiG_0w",
        authDomain: "goalnewsde-community.firebaseapp.com",
        projectId: "goalnewsde-community",
        storageBucket: "goalnewsde-community.firebasestorage.app",
        messagingSenderId: "134523022055",
        appId: "1:134523022055:web:4f35ed7812d06e4fb55042",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);
      setPersistence(auth, browserLocalPersistence);

      // ===== Maintenance Redirect =====
      function watchMaintenance() {
        const docRef = doc(db, "settings", "main");
        onSnapshot(docRef, (snap) => {
          if (!snap.exists())
            return console.error("Einstellungen nicht gefunden");
          const data = snap.data();
          if (data.maintenance) window.location.href = "wartungsarbeiten.html";
        });
      }
      watchMaintenance();

      // ===== Breaking News Toggle =====
      const breakingEl = document.getElementById("breakingNews");
      onAuthStateChanged(auth, (user) => {
        if (!user) {
          breakingEl.classList.add("locked");
          return;
        }
        const userRef = doc(db, "users", user.uid);
        onSnapshot(userRef, (snap) => {
          const data = snap.data() || {};
          breakingEl.classList.toggle("locked", !data.breakingNews);
        });
      });

      // ===== Live Games Rendering =====
      const tableBody = document.getElementById("tableBody");
      const matchTimers = new Map();

      // Map f√ºr bestehende Tabellenzeilen
      const matchRows = new Map();

      async function loadBundesligaMatches() {
        try {
          const res = await fetch("https://api.openligadb.de/getmatchdata/bl1");
          const matches = await res.json();

          if (!matches.length) {
            tableBody.innerHTML =
              "<tr><td colspan='3'>Keine Spiele gefunden</td></tr>";
            return;
          }

          matches.forEach(updateOrCreateRow);
        } catch (err) {
          console.error(err);
          tableBody.innerHTML =
            "<tr><td colspan='3'>Fehler beim Laden der Daten</td></tr>";
        }
      }

      function updateOrCreateRow(match) {
        const id = match.matchID;

        const home = match.team1.teamName;
        const away = match.team2.teamName;

        const goals = match.goals || [];
        const lastGoal = goals[goals.length - 1] || {};
        const score = goals.length
          ? `${lastGoal.scoreTeam1} : ${lastGoal.scoreTeam2}`
          : "- : -";

        // --- Status korrekt bestimmen ---
        let status = "Noch nicht gestartet";
        let minute = "";

        const start = new Date(match.matchDateTime);
        const now = new Date();

        const results = match.matchResults || [];
        const finalResult = results.find((r) => r.resultTypeID === 2);

        // --- 1) Spiel beendet (sicher) ---
        if (finalResult) {
          status = "Beendet";
        }

        // --- 2) Live (Startzeit vorbei, aber kein Endstand) ---
        else if (now > start) {
          status = "Live";

          if (match.matchMinute) {
            minute = `${match.matchMinute}'`;
          } else {
            const diff = Math.floor((now - start) / 60000);
            minute = diff < 90 ? `${diff}'` : "90+";
          }
        }

        // --- 3) Notfall: Keine Daten verf√ºgbar ---
        const endTime = new Date(start.getTime() + 120 * 60000); // 2h nach Start

        if (
          now > endTime && // Spiel m√ºsste vorbei sein
          goals.length === 0 && // keine Tore
          !finalResult // kein Endstand
        ) {
          status = "Keine Daten verf√ºgbar";
          minute = "";
        }

        let row = matchRows.get(id);

        // Falls die Reihe noch nicht existiert ‚Üí erstellen
        if (!row) {
          row = document.createElement("tr");
          row.innerHTML = `
      <td class="home"></td>
      <td class="away"></td>
      <td class="info"></td>
    `;
          tableBody.appendChild(row);
          matchRows.set(id, row);
        }

        // Inhalte aktualisieren (ohne Flackern)
        row.querySelector(".home").innerHTML = `
    <strong>${home}</strong><br>
    <small>${match.location?.locationCity || ""}</small>
  `;

        row.querySelector(".away").innerHTML = `
    <strong>${away}</strong><br>
    <small>${match.location?.locationStadium || ""}</small>
  `;

        row.querySelector(".info").innerHTML = `
    <div><strong>${score}</strong> ${minute}</div>
    <div><small>${status}</small></div>
    <div class="events">${renderEvents(goals)}</div>
  `;
      }

      function renderEvents(goals) {
        if (!goals.length) return "";

        return goals
          .map(
            (g) => `
      <div class="event">
        ${g.matchMinute}' ‚Äì 
        <strong>${g.goalGetterName}</strong>
        (${g.scoreTeam1}:${g.scoreTeam2})
      </div>
    `,
          )
          .join("");
      }

      // Alle 10 Sekunden aktualisieren
      loadBundesligaMatches();
      setInterval(loadBundesligaMatches, 10000);
    </script>

    <script>
      // ===== Countdown =====
      (function () {
        const countdownEl = document.getElementById("countdown");
        const targetDate = new Date("2026-02-08T20:30:00");

        function updateCountdown() {
          const now = new Date();
          let diff = targetDate - now;
          if (diff <= 0) {
            countdownEl.textContent = "l√§uft!";
            return;
          }
          const days = Math.floor(diff / 86400000);
          diff %= 86400000;
          const hours = Math.floor(diff / 3600000);
          diff %= 3600000;
          const minutes = Math.floor(diff / 60000);
          const seconds = Math.floor((diff % 60000) / 1000);
          const parts = [];
          if (days) parts.push(days + "d");
          if (hours) parts.push(hours + "h");
          if (minutes) parts.push(minutes + "m");
          parts.push(seconds + "s");
          countdownEl.textContent = parts.join(" ");
        }

        updateCountdown();
        setInterval(updateCountdown, 1000);
      })();

      // ===== Cookie Consent + Google Tag Manager & GA4 =====
      (function () {
        const COOKIE_KEY = "cookieConsent_v1";
        const GTM_ID = "GTM-XXXXXXX";
        function loadGTM() {
          if (window.gtmLoaded) return;
          window.gtmLoaded = true;

          window.dataLayer = window.dataLayer || [];
          window.dataLayer.push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js",
          });

          const gtmScript = document.createElement("script");
          gtmScript.async = true;
          gtmScript.src = `https://www.googletagmanager.com/gtm.js?id=${GTM_ID}`;
          document.head.appendChild(gtmScript);
        }

        function initCookieBanner() {
          const banner = document.getElementById("cookieBanner");
          const acceptBtn = document.getElementById("cookieAccept");
          const declineBtn = document.getElementById("cookieDecline");
          if (!banner || !acceptBtn || !declineBtn) return;

          const consent = localStorage.getItem(COOKIE_KEY);
          if (!consent) banner.style.display = "block";
          else if (consent === "accepted") loadGTM();

          acceptBtn.addEventListener("click", () => {
            localStorage.setItem(COOKIE_KEY, "accepted");
            banner.style.display = "none";
            loadGTM();
          });
          declineBtn.addEventListener("click", () => {
            localStorage.setItem(COOKIE_KEY, "declined");
            banner.style.display = "none";
          });
        }

        document.addEventListener("DOMContentLoaded", initCookieBanner);
      })();

      // ===== Hamburger Toggle =====
      const burger = document.getElementById("burger");
      const sideMenu = document.getElementById("sideMenu");
      burger.addEventListener("click", () => {
        burger.classList.toggle("active");
        sideMenu.classList.toggle("active");
      });
    </script>
  </body>
</html>
